name: Deploy to Snowflake

on:
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      # 1️⃣ Checkout your repo
      - name: Checkout Repository
        uses: actions/checkout@v4

      # 2️⃣ Install Snowflake CLI
      - name: Install Snowflake CLI
        run: |
          curl -L -o snowsql.bash https://sfc-repo.snowflakecomputing.com/snowsql/bootstrap/latest/linux_x86_64/snowsql-linux_x86_64.bash
          bash snowsql.bash -y

      # 3️⃣ Run the SQL script
      - name: Run Snowflake SQL Script
        env:
          SNOWSQL_ACCOUNT: ${{ secrets.SNOWFLAKE_ACCOUNT }}
          SNOWSQL_USER: ${{ secrets.SNOWFLAKE_USER }}
          SNOWSQL_PASSWORD: ${{ secrets.SNOWFLAKE_PASSWORD }}
          SNOWSQL_ROLE: ${{ secrets.SNOWFLAKE_ROLE }}
          SNOWSQL_WAREHOUSE: ${{ secrets.SNOWFLAKE_WAREHOUSE }}
        run: |
          snow sql \
            --connection default \
            --filename sql/setup.sql \
            --account $SNOWSQL_ACCOUNT \
            --user $SNOWSQL_USER \
            --role $SNOWSQL_ROLE \
            --warehouse $SNOWSQL_WAREHOUSE \
            --password-env SNOWSQL_PASSWORD \
            --silent
